Date.prototype.format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};try{/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a}catch(d){throw"Date format: "+d;}};
String.prototype.format=function(a){if(0==arguments.length)throw"format arguments is null.";1<arguments.length&&a.constructor!=Array&&(a=$.makeArray(arguments).slice(0));a.constructor!=Array&&(a=[a]);var b=this;$.each(a,function(a,d){b=b.replace(RegExp("\\{"+a+"\\}","g"),d)});return b};String.prototype.formatBool=function(a){switch(a){case "0":return"<font style='color:#ff0000'>\u5426</font>";case "1":return"<font style='color:#001eff'>\u662f</font>";default:return""}};
String.prototype.formatState=function(a){switch(a){case "0":return"<font style='color:#ff0000'>\u505c\u7528</font>";case "1":return"<font style='color:#001eff'>\u542f\u7528</font>";default:return""}};String.prototype.trim=function(){return this?$.trim(this).replace(/(^[\s\xA0]*)|([\s\xA0]*$)/g,""):""};String.prototype.trimString=function(a,b){return this.replace(RegExp(a,"gi"),function(a){return a.replace(/./g,b)})};
String.prototype.parseJSON=function(){try{return 0==this.indexOf("{")&&this.lastIndexOf("}")==this.length-1?(new Function("return "+this))():0==this.indexOf("[")&&this.lastIndexOf("]")==this.length-1?eval("("+this+")"):this}catch(a){return this}};
Array.prototype.toJSON=function(){try{if(this&&0<this.length&&!(this.length%2)){for(var a=[],b=0;b<this.length;b++)b%2?a.push('"',void 0==this[b]?"":this[b].toString().escaped(),'",'):a.push('"',this[b],'":');var c=a.join("");return"{"+c.substr(0,c.length-1)+"}"}return"{}"}catch(d){throw d;}};
String.prototype.escaped=function(){return this&&null!=this&&""!=this.trim()?this.replace(/\r/gi,"").replace(/\n/gi,"<br>").replace(/[<'">\\]/g,function(a){return{"<":"&#60;","'":"&#39;",'"':"&#34;",">":"&#62;","\\":"&#92;"}[a]}):this};String.prototype.count=function(){for(var a=0,b=0;b<this.length;b++)255<this.charCodeAt(b)?a+=2:a++;return a};
String.prototype.unescaped=function(a){a=a||!1;if(this&&null!=this&&""!=this.trim()){var b=this.replace(/&#(60|39|34|62|92);/g,function(a){return{"&#60;":"<","&#39;":"'","&#34;":'"',"&#62;":">","&#92;":"\\"}[a]});return a?b.replace(/<br>/gi,"\n"):b}return this};String.prototype.formatParseDate=function(){if(this&&null!=this&&""!=this.trim()){var a=this.trimString("[-\u5e74\u6708]+","/").trimString("\u65e5","");return"0000/00/00"==a||"0000/0/0"==a?"":(new Date(a)).format("yyyy/MM/dd")}return this};
String.prototype.formatParseDateTime=function(){if(this&&null!=this&&""!=this.trim()){var a=this.trimString("[-\u5e74\u6708]+","/").trimString("\u65e5","");return"0000/00/00 00:00:00"==a||"0000/0/0 0:00:00"==a?"":(new Date(a)).format("yyyy/MM/dd hh:mm:ss")}return this};String.prototype.formatAddDateDay=function(a){if(this&&null!=this&&""!=this.trim()){var b=new Date(this.trimString("[-\u5e74\u6708]+","/").trimString("\u65e5",""));return(new Date((new Date(b)).valueOf()+864E5*a)).format("yyyy/MM/dd hh:mm:ss")}return this};
$.fn.getTagStringArray=function(a){var b=this.find("input,select,textarea"),b=b.length?b:this,c=[];$.each(b,function(){var a=$getTagValue(this,!1,!1);a&&c.push(a)});a&&(a.constructor==Array?$.merge(c,a):c.push(a));return c};
function $getTagValue(a,b,c){var d=a.name,f=$(a),e=a.type,g=a.tagName.toLowerCase(),h;if(!d||"checkbox"==e||"radio"==e&&!a.checked||"submit"==e||"image"==e||"reset"==e||"button"==e||"file"==e||"select"==g&&"select-one"!=e)return null;try{var l=f.attr("ignore");if(l&&"true"==l.toLowerCase()||b&&(f.is(":hidden")||f.parents().is(":hidden")))return null;h=a.value;if("select"==g){var m=a.selectedIndex,k=a.options[-1>=m?0:m];h=k?k.value||k.text||"":""}if("text"==e){var n=f.attr("pack");n&&"dropdown"==n.toLowerCase()&&
(h=f.attr("key")||"")}}catch(p){h=""}return c?'"{0}":"{1}"'.format(d,h.escaped()):"{0}:{1}".format(d,h.escaped())}Array.prototype.block=function(a,b,c,d){try{a=parseInt(a)}catch(f){return this}if(!b||!c||!d)return this;var e=Math.floor(this.length/a)-1+(this.length%a?1:0);if(0<e)for(var g=1;g<=e;g++)this.insert(g*a-1+(g-1),b);this.unshift(c);this.push(d);return this};
$.sysProcess=function(a){return $.isPlainObject(a)&&a.sysCode?(new Function(a.sysText.unescaped())).call(a):$.isPlainObject(a)&&a.Message?(Page.global.systemPrompts("N",a.Message),!1):!0};$.sysErrorProcess=function(a){Page.global.systemPrompts("N",a)};$.getRequestUrl=function(a){var b=window.document.location.href;a=window.document.location.pathname;var c=b.indexOf(a),b=b.substring(0,c);a=a.substring(0,a.substr(1).indexOf("/")+1);return b+a};
$.ajaxAsyn=function(a,b,c,d,f,e,g){$.isArray(b)&&(b=b.toJSON());$.isPlainObject(b)&&(b=$.makeObject(b));$.ajax({type:"POST",url:g?a:$.getRequestUrl(a),data:b,global:!1,contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){var b;try{b=a.d.parseJSON(),b||(b=a.d)}catch(d){b=a.d}$.sysProcess(b)&&c&&c(b)},error:function(a,b,c){a=a.responseText.parseJSON();d?d(a.Message):$.sysErrorProcess(a.Message)},complete:function(a,b){var c;try{(c=b.parseJSON())||(c=b)}catch(d){c=b}f&&f(c)},
beforeSend:function(a){e&&e()}})};$.ajaxSyncd=function(a,b,c){$.isArray(b)&&(b=b.toJSON());$.isPlainObject(b)&&(b=$.makeObject(b));a=$.ajax({type:"POST",url:c?a:$.getRequestUrl(a),data:b,global:!1,contentType:"application/json; charset=utf-8",dataType:"json",async:!1}).responseText.parseJSON();var d;try{d=a.d.parseJSON(),d||(d=a.d)}catch(f){d=a.d}if($.sysProcess(d))return d;throw"";};
$.ajaxSync=function(a,b,c){a=$.ajax({type:"POST",url:c?a:$.getRequestUrl()+"/"+a,data:$(b).serialize(),global:!1,contentType:"application/json; charset=utf-8",dataType:"json",async:!1}).JSON.parse();var d;try{d=a.d.parseJSON(),d||(d=a.d)}catch(f){d=a.d}return d};$.sysProcess=function(){return!0};$.sysErrorProcess=function(a){};$.msgTip=function(a,b,c){$(a).tips({side:2,msg:"{0}".format(b),bg:"#AE81FF",time:c?c:3});return!1};
